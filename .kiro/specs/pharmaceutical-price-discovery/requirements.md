# 需求文档

## 介绍

医药价格发现系统是一个渐进式的价格比较平台，从简单的单网站价格爬取开始，逐步扩展为完整的多平台比价和采购决策系统。系统设计遵循"先有框架，逐步完善"的原则，确保每个阶段都能独立运行并提供实用价值。

## 术语表

- **系统**: 医药价格发现系统
- **价格爬虫**: 网站价格数据采集组件
- **价格比较器**: 多平台价格对比组件
- **数据存储**: 价格数据持久化存储（SQLite/PostgreSQL）
- **Web界面**: 用户交互的网页界面
- **药品**: 包含名称、规格、剂型、价格等信息的商品

## 需求

---
### 阶段一：基础框架（MVP）
---

### 需求 1: 单网站价格爬取

**用户故事:** 作为用户，我希望能够从一个药品网站爬取价格数据，以便了解药品的当前价格。

#### 验收标准

1. 当用户指定目标网站URL时，价格爬虫应当能够访问该网站并提取药品信息
2. 当爬虫解析网页时，系统应当提取药品名称、规格、价格和来源信息
3. 当数据提取完成时，系统应当将数据保存到本地数据库中
4. 当爬取过程出错时，系统应当记录错误日志并继续处理其他页面
5. 系统应当支持通过命令行启动爬虫任务

### 需求 2: 基础数据存储

**用户故事:** 作为用户，我希望爬取的价格数据能够被持久化存储，以便后续查询和分析。

#### 验收标准

1. 当价格数据被爬取时，数据存储应当保存药品名称、规格、价格、来源网站和采集时间
2. 当存储相同药品的新价格时，系统应当保留历史记录而非覆盖
3. 当查询药品时，系统应当支持按名称模糊搜索
4. 当数据库初始化时，系统应当自动创建所需的表结构
5. 系统应当使用SQLite作为默认存储，便于快速上手

### 需求 3: 简单Web界面

**用户故事:** 作为用户，我希望通过网页界面查看爬取的价格数据，以便直观地了解药品价格。

#### 验收标准

1. 当用户访问首页时，Web界面应当显示最近爬取的药品价格列表
2. 当用户搜索药品时，系统应当返回匹配的药品及其价格信息
3. 当显示药品信息时，界面应当展示药品名称、规格、价格和来源
4. 当价格数据为空时，系统应当显示友好的提示信息
5. 系统应当提供简洁易用的界面，无需复杂配置即可使用

---
### 阶段二：多平台比价
---

### 需求 4: 多网站爬虫支持

**用户故事:** 作为用户，我希望能够同时爬取多个药品网站的价格，以便进行价格比较。

#### 验收标准

1. 当配置多个目标网站时，系统应当能够依次爬取各网站的价格数据
2. 当添加新网站时，系统应当支持通过配置文件定义爬虫规则
3. 当爬取不同网站时，系统应当统一数据格式进行存储
4. 当某个网站爬取失败时，系统应当继续爬取其他网站
5. 系统应当记录每个网站的爬取状态和结果统计

### 需求 5: 价格比较功能

**用户故事:** 作为采购人员，我希望能够比较同一药品在不同平台的价格，以便找到最优采购渠道。

#### 验收标准

1. 当用户查询某药品时，价格比较器应当显示该药品在各平台的价格
2. 当展示比价结果时，系统应当按价格从低到高排序
3. 当存在价格差异时，系统应当高亮显示最低价格
4. 当药品名称不完全匹配时，系统应当基于相似度进行模糊匹配
5. 系统应当显示价格差异的百分比，便于评估采购优势

### 需求 6: 药品名称标准化

**用户故事:** 作为用户，我希望系统能够识别不同网站上同一药品的不同名称写法，以便准确比价。

#### 验收标准

1. 当处理药品名称时，系统应当去除多余空格和特殊字符
2. 当遇到通用名和商品名时，系统应当建立映射关系
3. 当处理规格信息时，系统应当统一单位格式（如mg、g、ml）
4. 当名称标准化完成时，系统应当生成统一的药品标识
5. 系统应当支持手动添加药品名称别名映射

---
### 阶段三：智能监控与采购
---

### 需求 7: 价格变动监控

**用户故事:** 作为采购人员，我希望系统能够监控药品价格变动，以便及时发现采购机会。

#### 验收标准

1. 当定时爬取价格时，系统应当与历史价格进行比较
2. 当价格下降超过设定阈值时，系统应当标记为采购机会
3. 当价格上涨超过设定阈值时，系统应当发出预警提示
4. 当查看药品详情时，系统应当显示价格历史趋势图
5. 系统应当支持用户自定义监控的药品列表和阈值

### 需求 8: 采购建议生成

**用户故事:** 作为采购决策者，我希望系统能够基于价格数据提供采购建议，以便优化采购成本。

#### 验收标准

1. 当生成采购建议时，系统应当推荐价格最优的采购渠道
2. 当存在多个低价选项时，系统应当综合考虑价格稳定性
3. 当用户查看建议时，系统应当显示潜在的成本节省金额
4. 当价格波动较大时，系统应当提示等待更好时机
5. 系统应当支持导出采购建议报告